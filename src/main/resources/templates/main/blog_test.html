<html>

<head>
	<th:block th:replace="fragments/config :: configFragment"></th:block>
	<meta charset="UTF-8">
	<title>블로그 서치 메인 페이지</title>
</head>

<body>
	<div class="form-group row">
		<label class="col-sm-2 col-form-label">URL</label>
		<div class="col-sm-4">
			<input type="text" class="form-control" id="idUrl" placeholder="URL을 입력해주세요.">
		</div>
	</div>

	<div class="form-group row">
		<label class="col-sm-2 col-form-label">키워드</label>
		<div class="col-sm-4">
			<input type="text" class="form-control" id="idKeyword" placeholder="키워드를 입력해주세요.">
		</div>
	</div>

	<div class="form-group row">
		<label class="col-sm-2 col-form-label">정렬</label>
		<div class="col-sm-4">
			<select id="selectType" class="form-select">
				<option value="accuracy" selected>정확도순</option>
				<option value="recency">최신순</option>
			</select>
			<button onclick="searchBlog();">검색</button>
		</div>
	</div>

	<div class="col-md-12 mt-4">
		<table class="table table-striped table-horizontal table-bordered mt-3">
			<thead class="thead-strong">
				<tr>
					<th width="10%">제목</th>
					<th width="30%">내용</th>
					<th width="10%">url</th>
					<th width="10%">블로그 이름</th>
					<th width="20%">썸네일</th>
					<th width="20%">등록시간</th>
				</tr>
			</thead>
			<tbody id="tbody">
				<tr th:each="meta,documents : ${res}">
					<td>
						<span th:text="${documents.title}"></span></a>
					</td>
					<td>
						<span th:text="${documents.contents}"></span>
					</td>
					<td>
						<span th:text="${documents.url}"></span>
					</td>
					<td>
						<span th:text="${documents.blogname}"></span>
					</td>
					<td>
						<span th:text="${documents.thumbnail}"></span>
					</td>
					<td>
						<span th:text="${documents.datetime}"></span>
					</td>
				<tr>
			</tbody>
		</table>
		<!--<div class="row">
			<div class="col">
				<ul class="pagination">
					<li class="page-item" th:each="index : ${#numbers.sequence(1, resultMap.totalPage)}" th:with="paging=${resultMap.paging}">
						<a class="page-link" th:classappend="${paging.pageNumber ==  (index-1)} ? bg-primary : bg-secondary" th:href="@{./list(page=${index - 1},page=${paging.pageSize})}">
							<span class="text-white" th:text="${index}"></span>
						</a>
					</li>
				</ul>
			</div>
		</div>-->
	</div>

	<!--<table id="table" data-height="600" data-filter-control="true" data-fixed-columns="true" data-pagination="true"
		data-page-size="10" data-page-list="[10, 25, 50, 100, All]">

		<thead>
			<tr>
				<th data-field="title">제목</th>
				<th data-field="contents">내용</th>
				<th data-field="url">url</th>
				<th data-field="blogname">블로그 이름</th>
				<th data-field="thumbnail" data-formatter="imageFormatter">썸네일</th>
				<th data-field="datetime">등록시간</th>
			</tr>
		</thead>
	</table>-->


</body>
<script>

	var authKey = "KakaoAK c71c96f80628b4c6cd9a8491bf10f052";


	function searchBlog() {


		var query = $("#idUrl").val();

		//test
		if (true) {query = "https://brunch.co.kr";}
		//

		var keyword = $("#idKeyword").val();
		var sort = $("#selectType").val();

		var pageSize = $(".page-size").val();
		alert(pageSize);

		if (keyword != null) {
			query = query + " " + keyword;
		}

		$.ajax({
			type: 'GET',
			url: 'https://dapi.kakao.com/v2/search/blog',
			data: {query: query, sort: sort, size: 50},
			headers: {Authorization: authKey},
			success: function (res) {
				debugger;

				if (res.meta.total_count == 0) {
					alert("데이터가 없습니다.");
				}

				$("table").bootstrapTable('destroy').bootstrapTable({data: res.documents});
			}
		});

		//
		//$.ajax({
		//	type: 'GET',
		//	url: 'https://openapi.naver.com/v1/search/blog.json',
		//	data: { query: $("#idSearchData").val() },
		//	headers: { "X-Naver-Client-Id": "NizjeMzYMtrvW5ZqtuwI"
		//		,		"X-Naver-Client-Secret" : "6Jt2m8TJmd"},
		//	success: function (res) {
		//		alert(res.documents);
		//		$("table").bootstrapTable('destroy').bootstrapTable({data:res.documents});				
		//	}
		//});
	}

	function imageFormatter(value, row, index) {
		return [
			'<img src="' + row.thumbnail + '"></img>'
		].join('');
	}

	$(function () {
		initTable();
	})

	function initTable() {
		$("#table").bootstrapTable({
			height: 550,
			columns: [
				{
					field: 'title',
					align: 'center',
					valign: 'middle'
				}, {
					title: 'contents',
					field: 'id',
					align: 'center',
					valign: 'middle',
					sortable: true,
				}, {
					title: 'url',
					align: 'center'
				}
			]
		})
	}


</script>

</html>